{%- for product in ["raspberrypi4", "raspberrypi3", "rockpi4", "tinkerboard", "qemux86-64"] %}
{%- for version in ["default", "hardknott"] %}
{%- for upstream in [false, true] %}
---
apiVersion: tekton.dev/v1beta1
kind: PipelineRun
metadata:
  generateName: {{ product }}-{{ version }}{{ "-upstream" if upstream else "" }}-
  namespace: yocto-build
  labels:
    product: {{ product }}
    version: {{ version }}
    upstream: "{{ 'true' if upstream else 'false' }}"
spec:
  pipelineRef:
    name: yocto-whisk-pipeline
  params:
    - name: url
      value: https://github.com/JPEWdev/yocto-doom-demo.git
    - name: revision
      value: main
    - name: depth
      value: "1"
    - name: products
      value: "{{ product }}"
    - name: mode
      value: development
    - name: site
      value: tekton
    - name: version
      value: "{{ version }}"
    - name: submoduleRemote
      value: "{{ 'true' if upstream else 'false' }}"
  workspaces:
    - name: build-workspace
      subPath: build
      volumeClaimTemplate:
        spec:
          storageClassName: fast-disks
          accessModes:
            - ReadWriteOnce
          resources:
            requests:
              storage: 32Gi
  timeout: 10h
  podTemplate:
    priorityClassName: yocto-build-priority
  taskRunSpecs:
    - pipelineTaskName: clone
      taskPodTemplate:
        priorityClassName: yocto-clone-priority
{%- endfor %}
{%- endfor %}
{%- endfor %}
